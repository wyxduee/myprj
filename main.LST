C51 COMPILER V9.51   MAIN                                                                  05/08/2018 22:35:24 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <REGX52.H>
   2          //#include<AT89x51.H>
   3          #include "stdio.h"
   4          
   5          
   6          unsigned char receive_buff[50];
   7          
   8          
   9          void delay(unsigned int x){
  10   1        unsigned char i;
  11   1        while(x--){
  12   2          for(i=0;i<120;i++);
  13   2        }
  14   1      }
  15          
  16          
  17          // void send_char (unsigned char c){
  18          //  SBUF=c;
  19          //  while(TI==0);
  20          //  TI=0;
  21          // }
  22          //  unsigned char *s;
  23          // void send_str(unsigned char *k){
  24          //  s=k;
  25          //  while(*s != '\0'){
  26          //    send_char(*s);
  27          //    s++;
  28          //    //delay(5);
  29          //  }
  30          //  s=NULL;
  31          //  
  32          // }
  33          void send_str(unsigned char *s)
  34          {
  35   1        ES=0;
  36   1        if(*s=='\0')
  37   1        {
  38   2            return;
  39   2        }
  40   1        else 
  41   1        {
  42   2          while(*s!=0){
  43   3            SBUF=*s;
  44   3            while(TI==0);
  45   3            TI=0;
  46   3            s++;    
  47   3        }
  48   2        ES=1;
  49   2        
  50   2      }
  51   1      return;
  52   1      }
  53          
  54          void send_char(unsigned char c)
  55          {
C51 COMPILER V9.51   MAIN                                                                  05/08/2018 22:35:24 PAGE 2   

  56   1          ES=0;
  57   1          SBUF=c;
  58   1          while(TI==0);
  59   1          TI=0;
  60   1          ES=1;
  61   1          return;
  62   1      }
  63          
  64          // void PutString(unsigned char *TXStr)  
  65          // {                
  66          //     ES=0;     
  67          //      while(*TXStr!=0) 
  68          //     {                      
  69          //         SBUF=*TXStr;
  70          //         while(TI==0);
  71          //         TI=0;    
  72          //         TXStr++;
  73          //     }
  74          //     ES=1; 
  75          // }  
  76          //unsigned char * RecStr;
  77          //unsigned int count;  
  78          //unsigned char num=0;
  79          //
  80          
  81          
  82          
  83          /************************************************************************/
  84              #define Imax 14000    //此处为晶振为11.0592时的取值, 
  85              #define Imin 8000    //如用其它频率的晶振时,
  86              #define Inum1 1450    //要改变相应的取值。
  87              #define Inum2 700 
  88              #define Inum3 3000 
  89          
  90            unsigned char f=0;
  91              unsigned char Im[4]={0x00,0x00,0x00,0x00};
  92              unsigned char show[2]={0,0};
  93              unsigned long m,Tc;
  94              unsigned char IrOK;
  95          
  96             
  97          /************************************************************************/  
  98          /************************************************************************/  
  99          //外部中断解码程序
 100            void intersvr1(void) interrupt 2 using 1
 101          {
 102   1          Tc=TH0*256+TL0;                                               //提取中断时间间隔时长
 103   1          TH0=0; 
 104   1          TL0=0;              //定时中断重新置零
 105   1       if((Tc>Imin)&&(Tc<Imax))
 106   1            { 
 107   2              m=0;
 108   2              f=1;
 109   2              return;
 110   2            }       //找到启始码
 111   1      
 112   1         if(f==1)
 113   1            {
 114   2              if(Tc>Inum1&&Tc<Inum3) 
 115   2          {
 116   3         Im[m/8]=Im[m/8]>>1|0x80; m++; 
 117   3             }
C51 COMPILER V9.51   MAIN                                                                  05/08/2018 22:35:24 PAGE 3   

 118   2            if(Tc>Inum2&&Tc<Inum1) 
 119   2              {
 120   3               Im[m/8]=Im[m/8]>>1; m++; //取码
 121   3        }
 122   2        if(m==32) 
 123   2         {
 124   3               m=0;  
 125   3               f=0;
 126   3               if(Im[2]==~Im[3]) 
 127   3            {
 128   4                 IrOK=1; 
 129   4         }
 130   3              else IrOK=0;   //取码完成后判断读码是否正确
 131   3           }
 132   2                     //准备读下一码
 133   2         }
 134   1       
 135   1      }
 136          /************************************************************************/
 137          unsigned char i;
 138          unsigned int count;
 139          void rsint() interrupt 4 using 0
 140          {   
 141   1          i=0;
 142   1          count=0;
 143   1          receive_buff[i]=SBUF;
 144   1          RI=0;
 145   1        loop:
 146   1          i++;
 147   1          while(!RI){
 148   2              count++;
 149   2              if(count>130){
 150   3                receive_buff[i]='\0';
 151   3                send_str(receive_buff);
 152   3                return ;
 153   3              }
 154   2            receive_buff[i]=SBUF;
 155   2          }
 156   1          RI=0;
 157   1          count=0;
 158   1          goto loop;
 159   1      }
 160          
 161          
 162          
 163          
 164          /*********************************************************************/ 
 165          //用简单的方法定义小车运动语句---直接IO口定义
 166            #define Left_moto_go      {P1_4=1,P1_5=0,P1_6=0,P1_7=1;}    //左边两个电机向前走
 167            #define Left_moto_back    {P1_4=0,P1_5=1,P1_6=1,P1_7=0;}  //左边两个电机向后转
 168            #define Left_moto_Stop    {P1_4=0,P1_5=0,P1_6=0,P1_7=0;}    //左边两个电机停转                     
 169            #define Right_moto_go     {P1_0=1,P1_1=0,P1_2=0,P1_3=1;}  //右边两个电机向前走
 170            #define Right_moto_back   {P1_0=0,P1_1=1,P1_2=1,P1_3=0;}  //右边两个电机向后走
 171            #define Right_moto_Stop   {P1_0=0,P1_1=0,P1_2=0,P1_3=0;}  //右边两个电机停转  
 172          
 173          /************************************************************************/
 174          //前速前进
 175               void  run(void)
 176          {
 177   1          
 178   1         Left_moto_go ;   //左电机往前走
 179   1         Right_moto_go ;  //右电机往前走
C51 COMPILER V9.51   MAIN                                                                  05/08/2018 22:35:24 PAGE 4   

 180   1      }
 181          
 182          //前速后退
 183               void  backrun(void)
 184          {
 185   1          
 186   1         Left_moto_back ;   //左电机往前走
 187   1         Right_moto_back ;  //右电机往前走
 188   1      }
 189          
 190          //左转
 191               void  leftrun(void)
 192          {
 193   1          
 194   1         Left_moto_back ;   //左电机往前走
 195   1         Right_moto_go ;  //右电机往前走
 196   1      }
 197          
 198          //右转
 199               void  rightrun(void)
 200          {
 201   1          
 202   1         Left_moto_go ;   //左电机往前走
 203   1         Right_moto_back ;  //右电机往前走
 204   1      }
 205          //STOP
 206               void  stoprun(void)
 207          {
 208   1          
 209   1         Left_moto_Stop ;   //左电机往前走
 210   1         Right_moto_Stop ;  //右电机往前走
 211   1      }
 212          
 213          
 214          
 215            void main(void)
 216          {
 217   1          TMOD=0x21;  
 218   1          TH1=0xFd;        //11.0592M??????9600??????
 219   1          TL1=0xFd;
 220   1          SCON=0x50;  
 221   1          //TMOD &=~0x11;
 222   1          PCON=0x00;
 223   1          //PCON |=0x80;
 224   1          TR1=1;
 225   1          ES=1;  
 226   1          TI=0;
 227   1          RI=0;
 228   1          EA=1;  
 229   1        
 230   1          IT1=1;
 231   1          EX1=1;
 232   1       
 233   1        //  TMOD|=0x11;  
 234   1          TH0=0;
 235   1          TL0=0;
 236   1          TR0=1;
 237   1          EA=1;
 238   1          Im[4]='\0';
 239   1      
 240   1        while(1)              /*无限循环*/
 241   1        { 
C51 COMPILER V9.51   MAIN                                                                  05/08/2018 22:35:24 PAGE 5   

 242   2      
 243   2            if(IrOK==1) 
 244   2           { 
 245   3             send_char(Im[2]);
 246   3      //              switch(Im[2])
 247   3      //        {
 248   3      //      case 0x18:  run();           //前进
 249   3      //              break;
 250   3      //      case 0x52:  backrun();         //后退  
 251   3      //              break;
 252   3      //      case 0x5a:  leftrun();       //左转
 253   3      //              break;
 254   3      //   case 0x08:  rightrun();       //右转
 255   3      //              break;
 256   3      //   case 0x1C:  stoprun();      //停止
 257   3      //              break;
 258   3      //   default:break;
 259   3      
 260   3          //  }
 261   3      
 262   3                 IrOK=0;
 263   3           }
 264   2         
 265   2                 
 266   2         }
 267   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    633    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     69    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
