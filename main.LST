C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <REGX52.H>
   2          //#include <AT89x51.H>
   3          #include "stdio.h"
   4          #include <intrins.h>
   5          
   6          
   7          unsigned char receive_buff[5];
   8          unsigned char stage_flag=0;
   9           unsigned char work_time=10;
  10          void delay(unsigned int x){
  11   1        unsigned char i;
  12   1        while(x--){
  13   2          for(i=0;i<120;i++);
  14   2        }
  15   1      }
  16          
  17          
  18          void send_str(unsigned char *s)
  19          {
  20   1        ES=0;
  21   1        if(*s=='\0')
  22   1        {
  23   2            return;
  24   2        }
  25   1        else 
  26   1        {
  27   2          while(*s!=0){
  28   3            SBUF=*s;
  29   3            while(TI==0);
  30   3            TI=0;
  31   3            s++;    
  32   3        }
  33   2        ES=1;
  34   2        
  35   2      }
  36   1      return;
  37   1      }
  38          
  39          void send_char(unsigned char c)
  40          {
  41   1          ES=0;
  42   1          SBUF=c;
  43   1          while(TI==0);
  44   1          TI=0;
  45   1          ES=1;
  46   1          return;
  47   1      }
  48          
  49          
  50          /************************************************************************/
  51              #define Imax 14000    //´Ë´¦Îª¾§ÕñÎª11.0592Ê±µÄÈ¡Öµ, 
  52              #define Imin 8000    //ÈçÓÃÆäËüÆµÂÊµÄ¾§ÕñÊ±,
  53              #define Inum1 1450    //Òª¸Ä±äÏàÓ¦µÄÈ¡Öµ¡£
  54              #define Inum2 700 
  55              #define Inum3 3000 
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 2   

  56          
  57            unsigned char f=0;
  58              unsigned char Im[4]={0x00,0x00,0x00,0x00};
  59              unsigned char show[2]={0,0};
  60              unsigned long m,Tc;
  61              unsigned char IrOK;
  62          
  63             
  64          /************************************************************************/  
  65          /************************************************************************/  
  66          //Íâ²¿ÖÐ¶Ï1½âÂë³ÌÐò
  67            void intersvr1(void) interrupt 2 using 1 //Íâ²¿ÖÐ¶Ï1
  68          {
  69   1          Tc=TH0*256+TL0;                                               //ÌáÈ¡ÖÐ¶ÏÊ±¼ä¼ä¸ôÊ±³¤
  70   1          TH0=0; 
  71   1          TL0=0;              //¶¨Ê±ÖÐ¶ÏÖØÐÂÖÃÁã
  72   1       if((Tc>Imin)&&(Tc<Imax))
  73   1            { 
  74   2              m=0;
  75   2              f=1;
  76   2              return;
  77   2            }       //ÕÒµ½ÆôÊ¼Âë
  78   1      
  79   1         if(f==1)
  80   1            {
  81   2              if(Tc>Inum1&&Tc<Inum3) 
  82   2          {
  83   3         Im[m/8]=Im[m/8]>>1|0x80; m++; 
  84   3             }
  85   2            if(Tc>Inum2&&Tc<Inum1) 
  86   2              {
  87   3               Im[m/8]=Im[m/8]>>1; m++; //È¡Âë
  88   3        }
  89   2        if(m==32) 
  90   2         {
  91   3               m=0;  
  92   3               f=0;
  93   3               if(Im[2]==~Im[3]) 
  94   3            {
  95   4                 IrOK=1; 
  96   4                if(stage_flag==0)
  97   4                {
  98   5                    if(Im[2]==0x16)
  99   5                    {
 100   6                      stage_flag=1;//1
 101   6                    }
 102   5                }
 103   4                else if(stage_flag==1)
 104   4                {
 105   5                    if(Im[2]==0x18)
 106   5                    {
 107   6                        work_time++;
 108   6                    }
 109   5                    else if(Im[2]==0x52)
 110   5                      {
 111   6                        if(work_time>1)
 112   6                          work_time--;
 113   6                          
 114   6                      }
 115   5                          
 116   5                      else if(Im[2]==0x1C)
 117   5                            stage_flag=2;
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 3   

 118   5                    }
 119   4      
 120   4                else if(stage_flag==3)//
 121   4                {
 122   5                    if(Im[2]==0x0C)
 123   5                    {
 124   6                      stage_flag=4;//
 125   6                    }
 126   5                }
 127   4                
 128   4         }
 129   3              else IrOK=0;   //È¡ÂëÍê³ÉºóÅÐ¶Ï¶ÁÂëÊÇ·ñÕýÈ·
 130   3           }
 131   2                     //×¼±¸¶ÁÏÂÒ»Âë
 132   2         }
 133   1       
 134   1      }
 135          /************************************************************************/
 136          unsigned char i;
 137          unsigned int count;
 138          void rsint() interrupt 4 using 0
 139          {   
 140   1          i=0;
 141   1          count=0;
 142   1          receive_buff[i]=SBUF;
 143   1          RI=0;
 144   1        loop:
 145   1          i++;
 146   1          while(!RI){
 147   2              count++;
 148   2              if(count>130){
 149   3                receive_buff[i]='\0';
 150   3                send_str(receive_buff);
 151   3                return ;
 152   3              }
 153   2            receive_buff[i]=SBUF;
 154   2          }
 155   1          RI=0;
 156   1          count=0;
 157   1          goto loop;
 158   1      }
 159          
 160          
 161          
 162          
 163          /*********************************************************************/ 
 164          //ÓÃ¼òµ¥µÄ·½·¨¶¨ÒåÐ¡³µÔË¶¯Óï¾ä---Ö±½ÓIO¿Ú¶¨Òå
 165            #define Left_moto_go      {P1_4=1,P1_5=0,P1_6=0,P1_7=1;}    //×ó±ßÁ½¸öµç»úÏòÇ°×ß
 166            #define Left_moto_back    {P1_4=0,P1_5=1,P1_6=1,P1_7=0;}  //×ó±ßÁ½¸öµç»úÏòºó×ª
 167            #define Left_moto_Stop    {P1_4=0,P1_5=0,P1_6=0,P1_7=0;}    //×ó±ßÁ½¸öµç»úÍ£×ª                     
 168            #define Right_moto_go     {P1_0=1,P1_1=0,P1_2=0,P1_3=1;}  //ÓÒ±ßÁ½¸öµç»úÏòÇ°×ß
 169            #define Right_moto_back   {P1_0=0,P1_1=1,P1_2=1,P1_3=0;}  //ÓÒ±ßÁ½¸öµç»úÏòºó×ß
 170            #define Right_moto_Stop   {P1_0=0,P1_1=0,P1_2=0,P1_3=0;}  //ÓÒ±ßÁ½¸öµç»úÍ£×ª  
 171          
 172          /************************************************************************/
 173          //Ç°ËÙÇ°½ø
 174               void  run(void)
 175          {
 176   1          
 177   1         Left_moto_go ;   //×óµç»úÍùÇ°×ß
 178   1         Right_moto_go ;  //ÓÒµç»úÍùÇ°×ß
 179   1      }
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 4   

 180          
 181          //Ç°ËÙºóÍË
 182               void  backrun(void)
 183          {
 184   1          
 185   1         Left_moto_back ;   //×óµç»úÍùÇ°×ß
 186   1         Right_moto_back ;  //ÓÒµç»úÍùÇ°×ß
 187   1      }
 188          
 189          //×ó×ª
 190               void  leftrun(void)
 191          {
 192   1          
 193   1         Left_moto_back ;   //×óµç»úÍùÇ°×ß
 194   1         Right_moto_go ;  //ÓÒµç»úÍùÇ°×ß
 195   1      }
 196          
 197          //ÓÒ×ª
 198               void  rightrun(void)
 199          {
 200   1          
 201   1         Left_moto_go ;   //×óµç»úÍùÇ°×ß
 202   1         Right_moto_back ;  //ÓÒµç»úÍùÇ°×ß
 203   1      }
 204          //STOP
 205               void  stoprun(void)
 206          {
 207   1          
 208   1         Left_moto_Stop ;   //×óµç»úÍùÇ°×ß
 209   1         Right_moto_Stop ;  //ÓÒµç»úÍùÇ°×ß
 210   1      }
 211          
 212          
 213          /************************************************************************/
 214          //ÊýÂë¹ÜÏÔÊ¾
 215          /************************************************************************/
 216          unsigned char const discode[] ={ 0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90,0xBF,0xff/*-*/};
 217          unsigned char const positon[4]={ 0xfe,0xfd,0xfb,0xf7};
 218          unsigned char disbuff[4]     ={ 0,0,0,0,};
 219          
 220          /********************************************************/
 221          unsigned char posit=0;
 222              void Display_time(void)        //ÊýÂë¹ÜÉ¨Ãè
 223            {
 224   1         P0=(discode[disbuff[posit]]);
 225   1            if(posit==0)
 226   1         { P2_0=0,P2_1=1;P2_2=1;P2_3=1;}
 227   1          if(posit==1)
 228   1         { P2_0=1,P2_1=0;P2_2=1;P2_3=1;}
 229   1          if(posit==2)
 230   1         { P2_0=1,P2_1=1;P2_2=0;P2_3=1;}
 231   1          if(posit==3)
 232   1         { P2_0=1,P2_1=1;P2_2=1;P2_3=0;}
 233   1          
 234   1         //P2=positon[posit];
 235   1          if(++posit>=4)
 236   1          posit=0;
 237   1        }
 238          
 239          
 240          
 241          /************************************************************************/
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 5   

 242          //¶æ»ú
 243          /************************************************************************/
 244            #define Sevro_moto_pwm     P2_7    //½Ó¶æ»úÐÅºÅ¶ËÊäÈëPWMÐÅºÅµ÷½ÚËÙ¶È
 245            unsigned char pwm_val_left  = 0;//±äÁ¿¶¨Òå
 246            unsigned char push_val_left =14;//¶æ»ú¹éÖÐ£¬²úÉúÔ¼£¬1.5MS ÐÅº
 247              unsigned int S=0;
 248            unsigned int S1=0;
 249            unsigned int S2=0;
 250            unsigned int S3=0;
 251            unsigned int S4=0;
 252            unsigned int  time=0;       //Ê±¼ä±äÁ¿
 253            unsigned int  timer=0;      //ÑÓÊ±»ù×¼±äÁ¿
 254            unsigned char timer1=0;     //É¨ÃèÊ±¼ä±äÁ¿  
 255          
 256          
 257          /************************************************************************/
 258          /*                    PWMµ÷ÖÆµç»ú×ªËÙ                                   */
 259          /************************************************************************/
 260          /*                    ×óµç»úµ÷ËÙ                                        */
 261          /*µ÷½Úpush_val_leftµÄÖµ¸Ä±äµç»ú×ªËÙ,Õ¼¿Õ±È            */
 262              void pwm_Servomoto(void)
 263          {  
 264   1       
 265   1          if(pwm_val_left<=push_val_left)
 266   1               Sevro_moto_pwm=1; 
 267   1        else 
 268   1               Sevro_moto_pwm=0;
 269   1        if(pwm_val_left>=200)
 270   1        pwm_val_left=0;
 271   1       
 272   1      }
 273          /************************************************************************/
 274          //³¬Éù²¨
 275          /************************************************************************/
 276            #define  ECHO  P2_4          //³¬Éù²¨½Ó¿Ú¶¨Òå
 277            #define  TRIG  P2_5          //³¬Éù²¨½Ó¿Ú¶¨Òå
 278          
 279          /************************************************************************/
 280               void  StartModule()          //Æô¶¯²â¾àÐÅºÅ
 281             {
 282   1          TRIG=1;                     
 283   1          _nop_(); 
 284   1          _nop_(); 
 285   1          _nop_(); 
 286   1          _nop_(); 
 287   1          _nop_(); 
 288   1          _nop_(); 
 289   1          _nop_(); 
 290   1          _nop_(); 
 291   1          _nop_(); 
 292   1          _nop_(); 
 293   1          _nop_(); 
 294   1          _nop_(); 
 295   1          _nop_(); 
 296   1          _nop_(); 
 297   1          _nop_(); 
 298   1          _nop_(); 
 299   1          _nop_();
 300   1          _nop_(); 
 301   1          _nop_(); 
 302   1          _nop_(); 
 303   1          _nop_();
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 6   

 304   1          TRIG=0;
 305   1         }
 306           /***************************************************/
 307          
 308           /***************************************************/
 309              void Conut(void)       //¼ÆËã¾àÀë
 310            {
 311   1          TH0=0;
 312   1          TL0=0;
 313   1          while(!ECHO);          //µ±RXÎªÁãÊ±µÈ´ý
 314   1          TR0=1;             //¿ªÆô¼ÆÊý
 315   1          while(ECHO);         //µ±RXÎª1¼ÆÊý²¢µÈ´ý
 316   1          TR0=0;           //¹Ø±Õ¼ÆÊý
 317   1          time=TH0*256+TL0;      //¶ÁÈ¡Âö¿í³¤¶È
 318   1          TH0=0;
 319   1          TL0=0;
 320   1          S=(time*1.7)/100;        //Ëã³öÀ´ÊÇCM
 321   1          //disbuff[0]=S%1000/100;   //¸üÐÂÏÔÊ¾
 322   1         // disbuff[1]=S%1000%100/10;
 323   1          //disbuff[2]=S%1000%10 %10;
 324   1        }
 325          /************************************************************************/
 326          
 327          /***************************************************/
 328             void Display_length(void)          //É¨ÃèÊýÂë¹Ü
 329            {
 330   1         if(posit==0)
 331   1         {P0=(discode[disbuff[posit]])&0x7f;}//²úÉúµã
 332   1         else
 333   1         {P0=discode[disbuff[posit]];}
 334   1      
 335   1          if(posit==0)
 336   1         { P2_1=0;P2_2=1;P2_3=1;}
 337   1          if(posit==1)
 338   1          {P2_1=1;P2_2=0;P2_3=1;}
 339   1          if(posit==2)
 340   1          {P2_1=1;P2_2=1;P2_3=0;}
 341   1          if(++posit>=3)
 342   1          posit=0;
 343   1        }
 344            
 345          
 346          
 347           unsigned int timer_int_count=0;
 348          
 349            
 350            
 351            
 352            //¶¨Ê±Æ÷1ÖÐ¶Ï
 353            void time1()interrupt 3   using 2
 354          { 
 355   1         TH1=(65536-100)/256;   //100US¶¨Ê±
 356   1         TL1=(65536-100)%256;
 357   1         timer++;         //¶¨Ê±Æ÷100USÎª×¼¡£ÔÚÕâ¸ö»ù´¡ÉÏÑÓÊ±
 358   1         pwm_val_left++;
 359   1         pwm_Servomoto();
 360   1      
 361   1         timer1++;         //2MSÉ¨Ò»´ÎÊýÂë¹Ü
 362   1         if(timer1>=20)
 363   1         {
 364   2         timer1=0;
 365   2         Display_time();
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 7   

 366   2        timer_int_count++;
 367   2        if(timer_int_count==500)
 368   2         {
 369   3           timer_int_count=0;
 370   3           if(work_time==0)
 371   3           {
 372   4              //work_time=20;
 373   4              stage_flag++;
 374   4             return;
 375   4           }
 376   3           if(stage_flag==2)
 377   3              work_time--;
 378   3           disbuff[2]=work_time/10;
 379   3           disbuff[3]=work_time%10;
 380   3         }     
 381   2         }
 382   1      
 383   1      
 384   1       }
 385          /***************************************************/
 386           unsigned int timer0_count=0;
 387          
 388            void timer0()interrupt 1   using 0
 389          { 
 390   1        
 391   1        TH0=0xf8;
 392   1        TL0=0x30;
 393   1        timer0_count++; 
 394   1       }
 395          
 396           /***************************************************/
 397          /************************************************************************/
 398           void  COMM( void )   //·½Ïòº¯Êý        
 399            {
 400   1               
 401   1           
 402   1            push_val_left=9;    //¶æ»úÏò×ó×ª90¶È
 403   1            timer=0;
 404   1            while(timer<=2000); //ÑÓÊ±400MSÈÃ¶æ»ú×ªµ½ÆäÎ»ÖÃ    4000
 405   1            StartModule();    //Æô¶¯³¬Éù²¨²â¾à
 406   1                Conut();        //¼ÆËã¾àÀë
 407   1            S2=S;  
 408   1        
 409   1            push_val_left=19;   //¶æ»úÏòÓÒ×ª90¶È
 410   1            timer=0;
 411   1            while(timer<=2000); //ÑÓÊ±400MSÈÃ¶æ»ú×ªµ½ÆäÎ»ÖÃ
 412   1            StartModule();    //Æô¶¯³¬Éù²¨²â¾à
 413   1                Conut();        //¼ÆËã¾àÀë
 414   1            S4=S;   
 415   1        
 416   1      
 417   1            push_val_left=14;   //¶æ»ú¹éÖÐ
 418   1            timer=0;
 419   1            while(timer<=2000); //ÑÓÊ±400MSÈÃ¶æ»ú×ªµ½ÆäÎ»ÖÃ
 420   1      
 421   1            StartModule();    //Æô¶¯³¬Éù²¨²â¾à
 422   1                Conut();        //¼ÆËã¾àÀë
 423   1            S1=S;   
 424   1      
 425   1                if((S2<40)||(S4<40)) //Ö»Òª×óÓÒ¸÷ÓÐ¾àÀëÐ¡ÓÚ£¬20CMÐ¡³µºóÍË
 426   1            {
 427   2            backrun();       //ºóÍË
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 8   

 428   2            timer=0;
 429   2            while(timer<=1000);
 430   2            }
 431   1             
 432   1            if(S2>S4)    
 433   1               {
 434   2              rightrun();   //³µµÄ×ó±ß±È³µµÄÓÒ±ß¾àÀëÐ¡  ÓÒ×ª  
 435   2                  timer=0;
 436   2                  while(timer<=1000);
 437   2               }              
 438   1                 else
 439   1               {
 440   2                 leftrun();   //³µµÄ×ó±ß±È³µµÄÓÒ±ß¾àÀë´ó  ×ó×ª
 441   2                 timer=0;
 442   2                 while(timer<=1000);
 443   2               }
 444   1                     
 445   1      
 446   1      }
 447          
 448          
 449          
 450          
 451          
 452          void length_count(void)
 453          {
 454   1        EX1=0;
 455   1        TH1=0;
 456   1        TL1=0;
 457   1        while(!ECHO);          //µ±RXÎªÁãÊ±µÈ´ý
 458   1        TR1=1;
 459   1        while(ECHO);         //µ±RXÎª1¼ÆÊý²¢µÈ´ý
 460   1        TR1=0;           //¹Ø±Õ¼ÆÊý
 461   1        time=TH1*256+TL1;      //¶ÁÈ¡Âö¿í³¤¶È
 462   1        S=(time*1.7)/100;        //Ëã³öÀ´ÊÇCM
 463   1        TH1=0;
 464   1        TL1=0;
 465   1        m=0;
 466   1        f=0;
 467   1        EX1=1;
 468   1        TR1=1;
 469   1      }
 470          
 471          
 472          
 473          
 474          
 475          
 476          void main(void){
 477   1      //ÏµÍ³´¦ÓÚºìÍâ½ÓÊÜ×´Ì¬£¬µÈ´ý½ÓÊÕÒ£¿ØÐÅºÅÆô¶¯¹¤×÷
 478   1        //ÐèÒªÓÃµ½µÄ¹¦ÄÜÓÐ£ººìÍâ½ÓÊÜ½âÂë,Íâ²¿ÖÐ¶Ï1ºÍ¼ÆÊýÆ÷1
 479   1        TMOD=0x01;//ÉèÖÃ¶¨Ê±Æ÷1Îª16bitÄ£Ê½
 480   1      
 481   1        IT1=1;//ÉèÖÃÍâ²¿ÖÐ¶Ï1Îª±ßÑØ´¥·¢
 482   1        EX1=1;//ÔÊÐíÍâ²¿ÖÐ¶Ï1ÖÐ¶Ï
 483   1        EA=1;//¿ªÆô×ÜÖÐ¶Ï
 484   1        TR0=1;//Æô¶¯¶¨Ê±Æ÷1
 485   1        P2_6=0;
 486   1        while(stage_flag==0);
 487   1        EA=0;//¹Ø±Õ×ÜÖÐ¶Ï
 488   1        EX1=0;//½ûÖ¹Íâ²¿ÖÐ¶Ï1
 489   1        TR0=0;//¹Ø±Õ¶¨Ê±Æ÷1
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 9   

 490   1        P2_6=1;
 491   1      //ÏµÍ³¿ªÊ¼¹¤×÷£¬³¬Éù²¨´ò¿ª±ÜÕÏ£¬²¢µ¹¼ÆÊ±1·ÖÖÓ
 492   1        //ÐèÒªÓÃµ½µÄ¹¦ÄÜÓÐ£º³¬Éù²¨±ÜÕÏ£¬ÊýÂë¹ÜÏÔÊ¾
 493   1      //
 494   1        TMOD=0x11;//ÉèÖÃ¶¨Ê±Æ÷0ºÍ¶¨Ê±Æ÷1Îª16bitÄ£Ê½
 495   1        TH1=(65536-100)/256;    //100US¶¨Ê±
 496   1        TL1=(65536-100)%256;
 497   1        EX1=1;
 498   1        ET1= 1;//ÔÊÐí¶¨Ê±Æ÷1ÖÐ¶Ï
 499   1        EA = 1;//¿ªÆô×ÜÖÐ¶Ï
 500   1        TR1= 1;//Æô¶¯¶¨Ê±Æ÷1
 501   1        TR0=1;
 502   1        push_val_left=14;
 503   1        delay(100);
 504   1        while(stage_flag==1);
 505   1        while(stage_flag==2)           /*ÎÞÏÞÑ­»·*/
 506   1        { 
 507   2         if(timer>=500)   //100MS¼ì²âÆô¶¯¼ì²âÒ»´Î  1000
 508   2           {
 509   3               timer=0;
 510   3             StartModule(); //Æô¶¯¼ì²â
 511   3                 Conut();     //¼ÆËã¾àÀë
 512   3                 if(S<20)     //¾àÀëÐ¡ÓÚ20CM
 513   3             {
 514   4             stoprun();   //Ð¡³µÍ£Ö¹
 515   4             COMM();      //·½Ïòº¯Êý
 516   4             }
 517   3             else
 518   3             if(S>40)     //¾àÀë´óÓÚ£¬30CMÍùÇ°×ß
 519   3             run();
 520   3           }
 521   2      
 522   2        }
 523   1          stoprun();
 524   1         {P2_1=1;P2_2=1;P2_3=1;}
 525   1        push_val_left=14;
 526   1        delay(100);
 527   1        ET1= 0;//¹Ø±Õ¶¨Ê±Æ÷1ÖÐ¶Ï
 528   1        EA=0;//¹Ø±Õ×ÜÖÐ¶Ï
 529   1        TR1=0;//Í£Ö¹¶¨Ê±Æ÷1
 530   1        P2_6=0;
 531   1          
 532   1      //µ¹¼ÆÊ±½áÊø£¬Ð¡³µ´ò¿ª¿ªÊ¼Ñ°ÕÒ³äµçµã·µ»Ø³äµç
 533   1        //ÐèÒªÓÃµ½µÄ¹¦ÄÜÓÐ£º³¬Éù²â¾à£¬ºìÍâ½ÓÊÜ
 534   1        //Íâ²¿ÖÐ¶Ï1 ºÍ¶¨Ê±Æ÷1 ¶¨Ê±Æ÷0 Íâ²¿ÖÐ¶Ï1ÓÃÀ´¼ì²âºìÍâÐÅºÅ£¬¶¨Ê±Æ÷1ÓÃÀ´¼ÇÂ¼³¬Éù²¨µÄÊ±³¤ ¶¨Ê±Æ÷0ÓÃÀ´¹Ì¶¨¶¨Ê±
 535   1        //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏÐòºÅ2   ¶¨Ê±Æ÷1¶ÔÓ¦ÖÐ¶ÏÐòºÅ3 ¶¨Ê±Æ÷0¶ÔÓ¦ÖÐ¶ÏÐòºÅ1
 536   1        
 537   1        TMOD=0x11;//ÉèÖÃ¶¨Ê±Æ÷0ºÍ1Îª16bit¶¨Ê±Ä£Ê½
 538   1        TH1=0;
 539   1        TL1=0;
 540   1        IT1=1;//ÉèÖÃÍâ²¿ÖÐ¶Ï1Îª±ßÑØ´¥·¢
 541   1        EX1=1;//ÔÊÐíÍâ²¿ÖÐ¶Ï1ÖÐ¶Ï
 542   1        TH0=0;
 543   1        TL0=0;
 544   1        Im[4]='\0';
 545   1        EA = 1;//¿ªÆô×ÜÖÐ¶Ï
 546   1        TR1=1;//Æô¶¯¶¨Ê±Æ÷1
 547   1        //TR0=1;//Æô¶¯¶¨Ê±Æ÷0
 548   1      
 549   1      
 550   1      while(stage_flag==3)
 551   1        {
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 10  

 552   2          rightrun();
 553   2          delay(50);
 554   2          stoprun();
 555   2          delay(300);
 556   2      }
 557   1        stoprun();
 558   1        EX1=0;
 559   1        TR1=0;
 560   1        TR0=0;
 561   1        while(S>20)
 562   1        {
 563   2          run();
 564   2          delay(100);
 565   2          stoprun();
 566   2          StartModule();    //Æô¶¯³¬Éù²¨²â¾à
 567   2          Conut();        //¼ÆËã¾àÀë
 568   2          delay(100);
 569   2        }
 570   1        stoprun();
 571   1        
 572   1      
 573   1      }
 574          
 575          
 576          
 577          
 578          
 579          // void main(void){
 580          // //ÏµÍ³´¦ÓÚºìÍâ½ÓÊÜ×´Ì¬£¬µÈ´ý½ÓÊÕÒ£¿ØÐÅºÅÆô¶¯¹¤×÷
 581          //  //ÐèÒªÓÃµ½µÄ¹¦ÄÜÓÐ£ººìÍâ½ÓÊÜ½âÂë,Íâ²¿ÖÐ¶Ï1ºÍ¼ÆÊýÆ÷1
 582          //  TMOD=0x10;//ÉèÖÃ¶¨Ê±Æ÷1Îª16bitÄ£Ê½
 583          
 584          //  IT1=1;//ÉèÖÃÍâ²¿ÖÐ¶Ï1Îª±ßÑØ´¥·¢
 585          //  EX1=1;//ÔÊÐíÍâ²¿ÖÐ¶Ï1ÖÐ¶Ï
 586          //  EA=1;//¿ªÆô×ÜÖÐ¶Ï
 587          //  TR1=1;//Æô¶¯¶¨Ê±Æ÷1
 588          //  P2_6=0;
 589          //  while(stage_flag==0);
 590          //  EA=0;//¹Ø±Õ×ÜÖÐ¶Ï
 591          //  EX1=0;//½ûÖ¹Íâ²¿ÖÐ¶Ï1
 592          //  TR1=0;//¹Ø±Õ¶¨Ê±Æ÷1
 593          //  P2_6=1;
 594          // //ÏµÍ³¿ªÊ¼¹¤×÷£¬³¬Éù²¨´ò¿ª±ÜÕÏ£¬²¢µ¹¼ÆÊ±1·ÖÖÓ
 595          //  //ÐèÒªÓÃµ½µÄ¹¦ÄÜÓÐ£º³¬Éù²¨±ÜÕÏ£¬ÊýÂë¹ÜÏÔÊ¾
 596          // //
 597          //  TMOD=0x11;//ÉèÖÃ¶¨Ê±Æ÷0ºÍ¶¨Ê±Æ÷1Îª16bitÄ£Ê½
 598          //  TH1=(65536-100)/256;    //100US¶¨Ê±
 599          //  TL1=(65536-100)%256;
 600          //  ET1= 1;//ÔÊÐí¶¨Ê±Æ÷1ÖÐ¶Ï
 601          //  EA = 1;//¿ªÆô×ÜÖÐ¶Ï
 602          //  TR1= 1;//Æô¶¯¶¨Ê±Æ÷1
 603          
 604          //  push_val_left=14;
 605          //  delay(100);
 606          //  while(stage_flag==1);
 607          //  while(stage_flag==2)           /*ÎÞÏÞÑ­»·*/
 608          //  { 
 609          //   if(timer>=500)   //100MS¼ì²âÆô¶¯¼ì²âÒ»´Î  1000
 610          //     {
 611          //         timer=0;
 612          //       StartModule(); //Æô¶¯¼ì²â
 613          //            Conut();      //¼ÆËã¾àÀë
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 11  

 614          //            if(S<20)      //¾àÀëÐ¡ÓÚ20CM
 615          //       {
 616          //       stoprun();   //Ð¡³µÍ£Ö¹
 617          //       COMM();      //·½Ïòº¯Êý
 618          //       }
 619          //       else
 620          //       if(S>40)     //¾àÀë´óÓÚ£¬30CMÍùÇ°×ß
 621          //       run();
 622          //     }
 623          
 624          //  }
 625          //    stoprun();
 626          //   {P2_1=1;P2_2=1;P2_3=1;}
 627          //  push_val_left=14;
 628          //  delay(100);
 629          //  ET1= 0;//¹Ø±Õ¶¨Ê±Æ÷1ÖÐ¶Ï
 630          //  EA=0;//¹Ø±Õ×ÜÖÐ¶Ï
 631          //  TR1=0;//Í£Ö¹¶¨Ê±Æ÷1
 632          //  P2_6=0;
 633          //    
 634          // //µ¹¼ÆÊ±½áÊø£¬Ð¡³µ´ò¿ª¿ªÊ¼Ñ°ÕÒ³äµçµã·µ»Ø³äµç
 635          //  //ÐèÒªÓÃµ½µÄ¹¦ÄÜÓÐ£º³¬Éù²â¾à£¬ºìÍâ½ÓÊÜ
 636          //  //Íâ²¿ÖÐ¶Ï1 ºÍ¶¨Ê±Æ÷1 ¶¨Ê±Æ÷0 Íâ²¿ÖÐ¶Ï1ÓÃÀ´¼ì²âºìÍâÐÅºÅ£¬¶¨Ê±Æ÷1ÓÃÀ´¼ÇÂ¼³¬Éù²¨µÄÊ±³¤ ¶¨Ê±Æ÷0ÓÃÀ´¹Ì¶¨¶¨
             -Ê±
 637          //  //Íâ²¿ÖÐ¶Ï1ÖÐ¶ÏÐòºÅ2   ¶¨Ê±Æ÷1¶ÔÓ¦ÖÐ¶ÏÐòºÅ3 ¶¨Ê±Æ÷0¶ÔÓ¦ÖÐ¶ÏÐòºÅ1
 638          //  
 639          //  TMOD=0x11;//ÉèÖÃ¶¨Ê±Æ÷0ºÍ1Îª16bit¶¨Ê±Ä£Ê½
 640          //  TH1=0;
 641          //  TL1=0;
 642          //  IT1=1;//ÉèÖÃÍâ²¿ÖÐ¶Ï1Îª±ßÑØ´¥·¢
 643          //  EX1=1;//ÔÊÐíÍâ²¿ÖÐ¶Ï1ÖÐ¶Ï
 644          //  TH0=0;
 645          //  TL0=0;
 646          //  Im[4]='\0';
 647          //  EA = 1;//¿ªÆô×ÜÖÐ¶Ï
 648          //  TR1=1;//Æô¶¯¶¨Ê±Æ÷1
 649          //  //TR0=1;//Æô¶¯¶¨Ê±Æ÷0
 650          
 651          
 652          // while(stage_flag==3)
 653          //  {
 654          //    rightrun();
 655          //    delay(50);
 656          //    stoprun();
 657          //    delay(300);
 658          // }
 659          //  stoprun();
 660          //  EX1=0;
 661          //  TR1=0;
 662          //  TR0=0;
 663          //  while(S>20)
 664          //  {
 665          //    run();
 666          //    delay(100);
 667          //    stoprun();
 668          //    StartModule();    //Æô¶¯³¬Éù²¨²â¾à
 669          //     Conut();       //¼ÆËã¾àÀë
 670          //    delay(100);
 671          //  }
 672          //  stoprun();
 673          //  
 674          
C51 COMPILER V9.51   MAIN                                                                  05/18/2018 20:49:33 PAGE 12  

 675          // }
 676          
 677          
 678          
 679          
 680          
 681          
 682          
 683          
 684          
 685          
 686          
 687          
 688          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1552    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     68    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
